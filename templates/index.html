<!DOCTYPE html>
<html>
<head>
    <title>Clasificador MNIST</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        canvas { border: 2px solid #000; margin: 20px 0; background: white; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #result { font-size: 24px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Clasificador de Dígitos MNIST</h1>
    
    <div>
        <canvas id="canvas" width="280" height="280"></canvas>
    </div>
    
    <div>
        <button onclick="predict()">Predecir</button>
        <button onclick="clearCanvas()">Limpiar</button>
    </div>
    
    <div id="result">Dibuja un número y haz clic en "Predecir"</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;

        // Configuración del dibujo
        ctx.lineWidth = 15;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000000';

        // Eventos para dibujar
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        function startDrawing(e) {
            isDrawing = true;
            draw(e);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            document.getElementById('result').innerText = 'Dibuja un número y haz clic en "Predecir"';
        }

        async function predict() {
            // Convertir canvas a imagen
            const image = canvas.toDataURL('image/png');
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ image: image.split(',')[1] })
                });
                
                const result = await response.json();
                document.getElementById('result').innerHTML = `
                    <strong>Predicción:</strong> ${result.digit}<br>
                    <strong>Probabilidad:</strong> ${(result.probabilities[result.digit] * 100).toFixed(2)}%
                `;
            } catch (error) {
                document.getElementById('result').innerText = 'Error al predecir: ' + error.message;
            }
        }
    </script>
</body>
</html>